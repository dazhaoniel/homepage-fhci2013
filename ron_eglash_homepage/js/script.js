/* --------------------------------------------------------------
   Map
-------------------------------------------------------------- */var map={defaultLngLat:[53.480333500044466,-2.238292694091797],mapObj:null,mapIcon:null,mkrId:null,mkrLat:null,mkrLon:null,init:function(){this.displayMap();this.frmSearch();this.frmSubmission()},frmSearch:function(){$(".btn-search").on("click",function(e){e.preventDefault();var t=$(".fld-search-postcode").val();map.geocoder(t,!0)});$(".frm-search").on("submit",function(e){e.preventDefault();$(".btn-search").trigger("click")})},frmSubmission:function(){$(".btn-add-club").on("click",function(e){e.preventDefault();$(".panel-map").fadeOut(300,function(){$(".panel-submission").fadeIn(300,function(){$.scrollTo($(".panel-submission"),{duration:400,axis:"y",offset:{top:-120}})})})});$(".btn-add-club-submit").on("click",function(e){e.preventDefault();$(".frm-add-club").trigger("submit")});$(".btn-cancel").on("click",function(e){e.preventDefault();$(".panel-submission").fadeOut(300,function(){$(".panel-map").fadeIn(300,function(){$.scrollTo($(".panel-map"),{duration:400,axis:"y",offset:{top:-120}})})})});$(".frm-add-club").on("submit",function(e){e.preventDefault();if($("form").h5Validate("allValid")){$dataString=$(".frm-add-club").serialize();$.ajax({type:"POST",url:"/map/submit",data:$dataString,success:function(e,t,n){e=jQuery.parseJSON(e);if(e&&jQuery.isEmptyObject(e)==0){map.mkrId=e.id;map.mkrLat=e.lat;map.mkrLon=e.lon;$(".map-container .map").remove();$(".map-container").html('<div class="map" id="map"></div>');map.mapObj=null;map.displayMap();$(".panel-submission").fadeOut(300,function(){$(".panel-map").fadeIn(300)});$(".frm-add-club")[0].reset()}else alert("Sorry but there was an error whilst adding your club to the map. Please try again later.")}})}})},displayMap:function(){map.mapObj==null&&(map.mapObj=L.map("map",{attributionControl:!1,scrollWheelZoom:!1}));L.tileLayer("http://a.tiles.mapbox.com/v3/rawdesign.map-cprh62cf/{z}/{x}/{y}.png",{attribution:"",minZoom:8,maxZoom:18,subdomains:"abcd",detectRetina:!0}).addTo(map.mapObj);map.mapIcon=L.icon({iconUrl:"/img/marker-icon.png",iconRetinaUrl:"/img/marker-icon@2x.png",iconSize:[25,41],iconAnchor:[13,5],shadowUrl:"/img/marker-shadow.png",shadowRetinaUrl:"/img/marker-shadow@2x.png",shadowSize:[68,80],shadowAnchor:[25,41]});this.populateData();map.mkrLon!=null&&map.mkrLat!=null?setTimeout(function(){var e=new L.LatLng(map.mkrLat,map.mkrLon);map.mapObj.setView(e,17)},400):map.mapObj.restoreView()||map.mapObj.setView(map.defaultLngLat,14)},populateData:function(){var e=$.ajax({url:"/map/feed.geojson",dataType:"json",async:!1});e.done(function(e){for(var t=0;t<e.features.length;t++){var n=e.features[t],r=new L.LatLng(n.geometry.coordinates[0],n.geometry.coordinates[1]),i=null,s=null,o="<h1>"+n.properties.name+"</h1>"+n.properties.content;marker=L.marker(r,{icon:map.mapIcon,riseOnHover:!0});s=L.popup();s.setContent(o);marker.bindPopup(s);marker.addTo(map.mapObj)}})},geocoder:function(e,t){var n=[];typeof t!="undefined"&&t&&$("#map").block({message:'<img src="/img/loading.gif" />',css:{border:"none",background:"none"}});if(e.length>0){e=encodeURIComponent(e);$url="/map/geocode/"+e;$jqxhr=null;setTimeout(function(){$jqxhr=$.ajax({url:$url,dataType:"json",async:!1});$jqxhr.done(function(e){if(e.length>0){var n=new L.LatLng(e[0].lat,e[0].lon);map.mapObj.setView(n,14);typeof t!="undefined"&&t&&$("#map").unblock()}else{alert("Sorry but we can't find that location. Please try a post code or be more specific.");typeof t!="undefined"&&t&&$("#map").unblock()}})},1e3)}}},animations={animationsDone:!1,init:function(){},wrapUpdateCounter:function(){$(".label .counter span").animate({someValue:$(".label .counter span").text()},{duration:3500,step:function(){$(this).text(Math.ceil(this.someValue))},complete:function(){$(this).text(this.someValue)}})}},navigation={init:function(){this.navigationClick();this.mobileNavigationInit();this.mobileNavigationToggle();this.mobileNavigationClick()},navigationClick:function(){$(".page-header .page-nav a").on("click",function(e){e.preventDefault();var t=$(this).attr("href");$.scrollTo(t,{duration:400,axis:"y",onAfter:function(){window.location.hash=t}})})},mobileNavigationInit:function(){var e=$(".page-header .page-nav").html();$(".nav-mobile .page-nav").html(e);$(".nav-mobile .page-nav .icon-cancel").remove()},mobileNavigationToggle:function(){$(".nav-reveal").on("click",function(e){e.preventDefault();$(".nav-mobile .page-nav").slideToggle(400)})},mobileNavigationClick:function(){$(".nav-mobile .page-nav a").on("click",function(e){e.preventDefault();$(".nav-mobile .page-nav").slideToggle(400);var t=$(this).attr("href");$.scrollTo(t,{duration:400,axis:"y",offset:{top:-50}})})}},urlHash={init:function(){$hash=window.location.hash;if($hash.length>0){$hash=$hash.replace("#","");$hash="#"+$hash;$activeElement=$("a[href='"+$hash+"']");$activeElement.length>0&&setTimeout(function(){$activeElement.trigger("click")},1)}}},helpers={timer:0,delay:50,init:function(){this.scrollHelperInit();this.iosHideAddressBar();this.externalLinks();this.slideShows()},scrollHelperInit:function(){$(window).scroll(function(){if(helpers.timer){clearTimeout(helpers.timer);helpers.timer=0}helpers.timer=setTimeout(helpers.scrollHelper,helpers.delay)})},scrollHelper:function(){$(".slider-01:in-viewport").length>0&&$(".slider-01").cycle("resume");$(".slider-02:in-viewport").length>0&&$(".slider-02").cycle("resume");$("#about-jim h1:in-viewport").length>0&&$(".nav-mobile h1").css("visibility","visible");$("#home:in-viewport").length>0&&$(".nav-mobile h1").css("visibility","hidden");var e="#"+$(".main-container > section:in-viewport:first").attr("id"),t=$(".page-nav a").filter("[href="+e+"]");if(t.length&&!t.is(".active")){$(".page-nav a").removeClass("active");t.addClass("active")}if($("body.lt-ie9").length==0&&animations.animationsDone==0&&$(".animation-scarf-container:in-viewport").length>0){animations.animationsDone=!0;animations.wrapUpdateCounter();$(".animation").each(function(e,t){var n=$(this).attr("data-animation");if(n!=undefined){$(this).addClass(n);$(this).removeAttr("data-animation")}})}},iosHideAddressBar:function(){setTimeout(function(){window.scrollTo(0,1)},0)},externalLinks:function(){$("a[href^='http://'],a[href^='https://']").each(function(){$(this).attr("target","_blank")})},slideShows:function(){$(".slider-01").cycle({pager:".slider-pagination-01",pagerActiveClass:"active",pagerTemplate:"<a href='#'><i class='icon-circle'></i></a>",timeout:4e3,slides:".slider-item",fx:"fade",speed:1e3,pauseOnHover:!0,swipe:!0,log:!1,paused:!0});$(".slider-02").cycle({pager:".slider-pagination-02",pagerActiveClass:"active",pagerTemplate:"<a href='#'><i class='icon-circle'></i></a>",timeout:4e3,slides:".slider-item",fx:"fade",speed:1e3,pauseOnHover:!0,swipe:!0,log:!1,paused:!0})}},polyfills={init:function(){this.pngToSvg();this.inputPlaceholder();this.formValidation()},pngToSvg:function(){if(!Modernizr.svg){$("img.svg-img").attr("src",function(){return $(this).attr("src").replace(".svg",".png")});$(".svg-img").fadeIn(200)}},inputPlaceholder:function(){$("input,textarea").placeholder()},formValidation:function(){$("form").h5Validate({errorClass:"error",focusout:!1,focusin:!1,change:!1,keyup:!1})}};$(function(){polyfills.init();helpers.init();navigation.init();urlHash.init();animations.init();map.init()});